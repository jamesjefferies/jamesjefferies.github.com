
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Setting up a Fresh Debian Server - James Jefferies and ShedCode Ltd</title>
  <meta name="author" content="James Jefferies">

  
  <meta name="description" content="Accessing the server Once set up, you will have the IP address, in the form 123.456.789.012 and the root password. This means you will be able to log &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesjefferies.com/2012/08/22/setting-up-a-fresh-debian-server/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Jefferies and ShedCode Ltd" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Bevan' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3110855-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Jefferies and ShedCode Ltd</a></h1>
  
    <h2>The world of James and ShedCode</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesjefferies.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="http://shedcode.co.uk/">ShedCode</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Setting Up a Fresh Debian Server</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-22T14:41:00+01:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Accessing the server</h2>

<p>Once set up, you will have the IP address, in the form 123.456.789.012 and the root password. This means you will be able to log on to the server using ssh (secure shell), i.e.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@123.456.789.012</span></code></pre></td></tr></table></div></figure>


<p>You will get a message along the lines of</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The authenticity of host '123.456.789.012(123.456.789.012)' can't be established. RSA key fingerprint is blah blah bla
</span><span class='line'>Are you sure you want to continue connecting (yes/no)?</span></code></pre></td></tr></table></div></figure>


<p>to which you will reply</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yes</span></code></pre></td></tr></table></div></figure>


<p>and you will then get</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Warning: Permanently added '123.456.789.012' (RSA) to the list of known hosts.
</span><span class='line'>root@123.456.789.012's password: </span></code></pre></td></tr></table></div></figure>


<p>which is when you can enter your password. Hopefully then you&#8217;ll be logged on to the server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blah blah blah snipâ€¦
</span><span class='line'>servername:~# </span></code></pre></td></tr></table></div></figure>


<h3>First things first</h3>

<p>Root access is the super user for your server. You really don&#8217;t want to have people being able to log on to your server as root. What you really need is to have user accounts which people can use to log on, and if/when required, they can get super user privileges to do whatever they need to do.</p>

<p>What we are going to do is to stop root being able to secure shell straight in to the server, create a new user account to use for our admin (with upgradable privileges) and run ssh on a different port to deter basic attacks.</p>

<h3>Change root&#8217;s password!</h3>

<p>So you have a default root password - CHANGE IT to a new one! From a root prompt, use <code>passwd</code> to change the password</p>

<h3>Adding a new user</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adduser james</span></code></pre></td></tr></table></div></figure>


<p>Will create a new user, called James - you can add in extra details as you go like full name etc.</p>

<p>Now we want to allow james a bit of privilege, not by default though, but by using the sudo command.</p>

<h4>Aside - setting default editor to be vi</h4>

<p>By default, for all users, you may want to use vi as your editor (ok, you may not, but I do!) so add the following to <code>/etc/profile</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>EDITOR=vi
</span><span class='line'>export EDITOR</span></code></pre></td></tr></table></div></figure>


<h3>Giving the new user sudo privileges</h3>

<p>You may need to install sudo if it isn&#8217;t already installed on your server. It&#8217;s a simple case of</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install sudo</span></code></pre></td></tr></table></div></figure>


<p>Then, the application <code>visudo</code> is your friend. You edit the config file using visudo and then sudo does the rest. When you open the file, you&#8217;ll see a section with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># User privilege specification
</span><span class='line'>root    ALL=(ALL) ALL
</span><span class='line'>admin ALL = (ALL) ALL
</span><span class='line'>james ALL = (ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>By adding my own entry, it allows me to upgrade my user to super user privileges for all actions. You can limit the commands which users can run if you like using this, but if you are going to be the super user, you probably want to leave it as all.</p>

<h2>Sorting out access</h2>

<p>Let&#8217;s stop people attempting to log on to the server as <a href="http://www.howtogeek.com/howto/linux/security-tip-disable-root-ssh-login-on-linux/">root via ssh</a> and also to run ssh on a different port than the default. There is a lot of good advice <a href="http://www.foogazi.com/2006/11/29/modify-ssh-to-maximize-security/">here</a></p>

<h3>Amend port</h3>

<p>The default port is 22, change this to something else, which isn&#8217;t being used by anything else</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># What ports, IPs and protocols we listen for
</span><span class='line'>Port 60</span></code></pre></td></tr></table></div></figure>


<h3>Stop root login</h3>

<p>Now stop people logging in as root</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PermitRootLogin no</span></code></pre></td></tr></table></div></figure>


<h3>Some other bits</h3>

<p>Give maximum number of log in attempts to be 3, only allow james to login.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MaxAuthTries 3
</span><span class='line'>AllowUsers james </span></code></pre></td></tr></table></div></figure>


<h3>Restart sshd</h3>

<p>As root (or sudo)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/ssh restart</span></code></pre></td></tr></table></div></figure>


<p>Now try logging in remotely from a different shell (i.e. keep the one you&#8217;ve just restarted sshd on open in case you have any problems!)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -p60 james@123.456.789.0123</span></code></pre></td></tr></table></div></figure>


<p>obviously set the p to be the port you set earlier.</p>

<h3>Stop chancers getting in</h3>

<p>It&#8217;s also a good idea to stop people attempting to log on to your server using common passwords, usernames etc. A good way to do this is to install the <a href="http://en.wikipedia.org/wiki/Fail2ban">fail2ban</a> which goes some way to banning people trying to brute force their way in to your server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install fail2ban</span></code></pre></td></tr></table></div></figure>


<p>Default settings are pretty good here.</p>

<h2>Firewall configuration</h2>

<p>UFW or Uncomplicated Firewall is a good first port of call for securing your shiny new server. You can install it as root with</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install ufw</span></code></pre></td></tr></table></div></figure>


<p>Now, unlike fail2ban, ufw is installed switched off. You need to configure a few things before getting it up and running and providing that extra security. By default ALL ports are shut, so make sure you&#8217;ve opened up the ones you need before switching the firewall on!</p>

<p>For example, if you&#8217;ve set up your ssh to run on port 60, then you need to run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ufw allow 60</span></code></pre></td></tr></table></div></figure>


<p>If you&#8217;re going to be running apache on port 80 (the usual)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ufw allow 80</span></code></pre></td></tr></table></div></figure>


<p>Here are a few <a href="http://www.mmncs.com/2011/07/this-guide-shows-howto-install-and-setup-uncomplicatedfirewall-ufw-on-linux-ubuntu-10-04-and-11-04-and-other-debian-distributions/">notes</a></p>

<p>Don&#8217;t forget to run <code>ufw enable</code> when you are ready! <code>ufw status</code> tells you what is set up.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Jefferies</span></span>

      








  


<time datetime="2012-08-22T14:41:00+01:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/categories/techie/'>Techie</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jamesjefferies.com/2012/08/22/setting-up-a-fresh-debian-server/" data-via="shedcode" data-counturl="http://jamesjefferies.com/2012/08/22/setting-up-a-fresh-debian-server/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/08/16/from-mysql-datadump-to-mongo/" title="Previous Post: From MySQL datadump to mongo">&laquo; From MySQL datadump to mongo</a>
      
      
        <a class="basic-alignment right" href="/2012/08/22/setting-up-wordpress/" title="Next Post: Setting up WordPress">Setting up WordPress &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/12/27/olympic-legacy-server-setup-part-1b/">Olympic legacy server setup - part 1b</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/20/olympic-legacy-server-setup-part-1/">Olympic legacy server setup - part 1</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/11/steam-powered-arduino-part-1/">Steam powered Arduino part 1</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/28/a-great-idea-for-amazon-deliveries/">A great idea for Amazon deliveries</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/16/scenic-railways-our-railway-hack/">Scenic Railways - our railway hack</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jamesjefferies">@jamesjefferies</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesjefferies',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shedcode", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shedcode" class="twitter-follow-button" data-show-count="false">Follow @shedcode</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - James Jefferies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesjefferiesblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jamesjefferies.com/2012/08/22/setting-up-a-fresh-debian-server/';
        var disqus_url = 'http://jamesjefferies.com/2012/08/22/setting-up-a-fresh-debian-server/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
