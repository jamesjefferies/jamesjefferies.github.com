
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gotcha with auto DDL generation and hibernate - James Jefferies and ShedCode Ltd</title>
  <meta name="author" content="James Jefferies">

  
  <meta name="description" content="During project development, we&#8217;re auto creating our database when the application initiates. This is superuseful initially, especially when the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesjefferies.github.com/blog/2009/04/14/gotcha-with-auto-ddl-generation-and-hibernate/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Jefferies and ShedCode Ltd" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Jefferies and ShedCode Ltd</a></h1>
  
    <h2>The world of James and ShedCode</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesjefferies.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Gotcha With Auto DDL Generation and Hibernate</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-14T12:41:31+01:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>During project development, we&#8217;re auto creating our database when the application initiates. This is superuseful initially, especially when the database is based on the domain objects rather than the other way around. Since switching to MySQL and a &#8216;real&#8217; database, rather than one in memory, there are a few gotchas. The one which caught me out this morning, for a few hours, involved adding and removing foreign keys automagically&#8230; it doesn&#8217;t really work!</p>

<p>this is useful by the way for <a href="http://www.hibernate.org/hib_docs/reference/en/html/configuration-optional.html">hibernate config</a> as is <a href="http://www.jroller.com/eyallupu/entry/hibernate_s_hbm2ddl_tool">this</a></p>

<p>anyway, we were set - <code>hibernate.hbm2ddl.auto=create</code></p>

<p>when actually, we should have used create-drop.</p>

<p>create will empty the database, whereas create-drop will properly drop it&#8230;</p>

<p>for completeness, here is the configuration for a entity manager, with the generate DDL parameter switching the ddl generation on and off, and the hibernate.hbm2ddl.auto parameter determining whether you do a create each time or an update or whatever.</p>

<pre><code>&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
        &lt;property name="loadTimeWeaver"&gt;
            &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver" /&gt;
        &lt;/property&gt;
        &lt;property name="persistenceUnitName" value="projectNamePU" /&gt;
        &lt;property name="jpaPropertyMap"&gt;
            &lt;map&gt;
                &lt;entry key="hibernate.search.default.directory_provider" value="org.hibernate.search.store.RAMDirectoryProvider"  /&gt;   
                &lt;entry key="hibernate.cache.provider_class" value="net.sf.ehcache.hibernate.SingletonEhCacheProvider" /&gt;
                &lt;entry key="hibernate.cache.provider_configuration" value="classpath:ehCache.xml" /&gt;
                &lt;entry key="hibernate.cache.use_second_level_cache" value="true" /&gt;
                &lt;entry key="hibernate.generate_statistics" value="true" /&gt;
                &lt;entry key="hibernate.cache.use_structured_entries" value="true" /&gt;
                &lt;entry key="hibernate.jdbc.batch_size" value="0" /&gt;
            &lt;entry key="hibernate.default_batch_fetch_size" value="20"/&gt;
            &lt;span style="color: #ff0000"&gt;&lt;entry key="hibernate.hbm2ddl.auto" value="${hibernate.hbm2ddl.auto}" /&gt;&lt;/span&gt;
            &lt;/map&gt;
        &lt;/property&gt;

        &lt;property name="dataSource" ref="dataSource"/&gt;
        &lt;property name="jpaVendorAdapter"&gt;
           &lt;bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"&gt;
                &lt;property name="database" value="${hibernate.database}" /&gt;
                &lt;property name="showSql" value="${hibernate.show_sql}" /&gt;
                &lt;span style="color: #ff0000"&gt;&lt;property name="generateDdl" value="${hibernate.generate_ddl}" /&gt;&lt;/span&gt;
                &lt;property name="databasePlatform" value="${hibernate.dialect}" /&gt;
            &lt;/bean&gt;          
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Jefferies</span></span>

      








  


<time datetime="2009-04-14T12:41:31+01:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jamesjefferies.github.com/blog/2009/04/14/gotcha-with-auto-ddl-generation-and-hibernate/" data-via="shedcode" data-counturl="http://jamesjefferies.github.com/blog/2009/04/14/gotcha-with-auto-ddl-generation-and-hibernate/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/04/14/java-dates-and-times/" title="Previous Post: Java dates and times...">&laquo; Java dates and times...</a>
      
      
        <a class="basic-alignment right" href="/blog/2009/04/22/hibernate-search-lucene-and-greenwich-mean-time/" title="Next Post: Hibernate Search, Lucene and Greenwich Mean Time">Hibernate Search, Lucene and Greenwich Mean Time &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/18/downloading-the-network-rail-schedules/">Downloading the Network Rail Schedules</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/16/the-electrified-spine-and-the-rest-of-the-news/">The Electrified Spine (and the rest of the news)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/04/getting-started-with-network-rails-datafeeds/">Getting started with Network Rail's datafeeds</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/22/week-10-the-end-of-the-happenstance/">Week 10 - the end of the Happenstance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/15/whatever-next-the-technical-stuff/">Whatever next - the technical stuff</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jamesjefferies">@jamesjefferies</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesjefferies',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shedcode", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shedcode" class="twitter-follow-button" data-show-count="false">Follow @shedcode</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - James Jefferies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
