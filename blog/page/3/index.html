
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Jefferies and ShedCode Ltd</title>
  <meta name="author" content="James Jefferies">
  <meta name="google-site-verification" content="x0Mk5K7-ZW7IoUe7Xczv5TvjRygnWGAboUyzxMYYDm0" />
  
  <meta name="description" content="I&#8217;m really chuffed to say that I&#8217;ve been successful in applying for a residency with the Happenstance Project. When I first heard about &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesjefferies.com/blog/page/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href='http://fonts.googleapis.com/css?family=Bevan' rel='stylesheet' type='text/css'>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Jefferies and ShedCode Ltd" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3110855-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Jefferies and ShedCode Ltd</a></h1>
  
    <h2>The world of James and ShedCode</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesjefferies.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/03/11/happenstance-project-technologist-in-residence/">Happenstance Project - Technologist in Residence</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-11T18:24:14+00:00" pubdate data-updated="true">Mar 11<span>th</span>, 2012</time>
        
         | <a href="/2012/03/11/happenstance-project-technologist-in-residence/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m really chuffed to say that I&#8217;ve been successful in applying for a residency with the <a href="http://happenstanceproject.com">Happenstance Project</a>. When I first heard about it, I thought it sounded interesting but, I didn&#8217;t consider my chances of getting a place were very high.</p>

<p>Filling in the application form was a great way to help me think through what I could offer and also helped me to realise that it was exactly the sort of thing I should try with my new found freelance freedom. So, some time later, I submitted the form to see what would happen. In all I think 60 odd people applied, so I was excited to find that I&#8217;d been invited to the sandpit day at <a href="http://www.nesta.org.uk/">NESTA</a> (The National Endowment for Science, Technology and the Arts) for a selection workshop and interview.</p>

<p>The day came and I zipped down to the big smoke on the train. Candidates were seen 6 at a time and my group including some strong candidates, including <a href="http://finalbullet.com">Leila Johnston</a> who will be my partner in crime for the project up at <a href="http://sitegallery.org">Site Gallery</a> in sunny Sheffield.</p>

<p>After all that, I was offered a place, hurrah!</p>

<p>So you may ask what I&#8217;ll be doing - well, that&#8217;s a very good question. From the project site:</p>

<blockquote><p>As a resident, you will be expected to:</p>

<h3>Complete Two Projects</h3>

<p><em>The main body of the residencies will be split into two short five-week sprints. Each resident, or pair of residents, will complete one small project or one prototype in each sprint. The first project will be based upon the idea that you submit in your application, which will be further refined during the Sandpit Day in February; the second will be based upon your observations while resident in the organisation.</em></p>

<h3>Share Your Work</h3>

<p><em>You will be asked to document your work on a weekly basis, via a project blog, and also participate in three ‘Open House’ events, where you will have the opportunity to present your work, talk through your process and discuss any wider themes or implications. During the residencies, you will have the opportunity to work with both a mentor and a project manager.</em></p></blockquote>

<p>My fellow Technologist In Residence, Leila, has written a good blog post about the kind of stuff we may end up doing. <a href="http://finalbullet.com/2012/03/10/im-going-to-sheffield/">Deffo worth a read</a>!</p>

<p>I&#8217;ll hopefully blog and tweet as I go with the project, as well as the official blog posts which will be part of my &#8216;write up&#8217; - not sure where that will be yet!</p>

<p>Hurrah!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/09/09/running-eclipse-under-the-unity-interface/">Running Eclipse Under the Unity Interface</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-09T10:00:36+01:00" pubdate data-updated="true">Sep 9<span>th</span>, 2011</time>
        
         | <a href="/2011/09/09/running-eclipse-under-the-unity-interface/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Unity eh? Love it or hate it the version in Ubuntu 11.04 seems not quite complete. Also other applications sometimes will not play nicely.</p>

<p>Eclipse is one of them, your menu items can go walk about. I found this <a href="http://blog.matto1990.com/2011/04/using-eclipse-under-ubuntu-11-04-natty/">blog post</a> which has a helpful hint. Unsetting UBUNTU_MENUPROXY for the application does the trick</p>

<pre><code>#!/bin/bash
unset UBUNTU_MENUPROXY
path/to/eclipse/here
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/25/disabling-liquibase-when-running-unit-tests/">Disabling Liquibase When Running Unit Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-25T10:33:44+01:00" pubdate data-updated="true">Aug 25<span>th</span>, 2011</time>
        
         | <a href="/2011/08/25/disabling-liquibase-when-running-unit-tests/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&#8217;re running Liquibase, configured by Spring (or whatever) and you don&#8217;t want it to run it&#8217;s checks when running unit tests, you can disable it from running by setting a system property.</p>

<p>Whilst running a single unit test class many times, you might want to add a system set property call before any of the tests are run. Hence:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@BeforeClass</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">switchOffLiquibase</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">Liquibase</span><span class="o">.</span><span class="na">SHOULD_RUN_SYSTEM_PROPERTY</span><span class="o">,</span> <span class="s">&quot;false&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/18/flickr-and-the-missing-images/">Flickr and the Missing Images</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-18T17:10:08+01:00" pubdate data-updated="true">Aug 18<span>th</span>, 2011</time>
        
         | <a href="/2011/08/18/flickr-and-the-missing-images/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A client got in touch with a weird problem, when logging in to flickr, some images wouldn&#8217;t download, the placeholders would be there with the classic little red cross indicating a problem.</p>

<h3>Idea 1 - funny URLs</h3>

<p>Thinking that something must be going wrong with the content delivery for those pictures, the farm was down or whatever, I asked him to send through the direct URL, plus to try accessing it himself. Well, usually it didn&#8217;t work, but sometimes, if he right clicked and asked the browser to download the image it did. Curious.</p>

<h3>Idea 2 - browsers</h3>

<p>Ok, well, maybe it&#8217;s just the browser messing up with its security levels. Nope, still the same on Safari, Chrome &amp; Firefox.</p>

<h3>Idea 3 - DNS</h3>

<p>Maybe the DNS is being bodged up for those server farms. Try google DNS - no joy. Try flushing Windows DNS cache - no joy.</p>

<h3>Idea 4 - Firefox&#8217;s exception list</h3>

<p>This is where I found out about <a href="http://www.flickr.com/help/test">Flickr&#8217;s test page </a> which is useful for trouble shooting this stuff. Apparently all the global column didn&#8217;t load on a clean firefox install. So we added farm1 to firefox&#8217;s image exception list. Boom, they all came back.. bizarre.</p>

<h3>Idea 5 - Conflict with security software</h3>

<p>The machine was XP SP 3 with AVG internet security installed. After a further prod around, Ad-aware was on there, as was McAfee. So, here&#8217;s an idea, boot in to safe mode with networking and see if that works&#8230; Hmm, nope.</p>

<h3>Idea 6 - Must be unrelated to the computer, belkin router anyone?</h3>

<p>Surely the ISP wouldn&#8217;t be messing about here&#8230; but what about the router. A belkin apparently, which is when I found a <a href="http://www.flickr.com/help/forum/72157627085259789/">flickr forum thread</a> of people with the same problem. Ah, belkin routers - this is starting to make sense. Believe it or not, switching off the router firewall (whilst maintaining a software firewall on the PC) meant that the images downloaded without a problem. Argh! It was the router all along. It seemed so obscure.</p>

<h3>In a nutshell</h3>

<p>If you are having problems with flickr (or other image intensive sites) and you have a belkin router with the firewall switched on. SWITCH it off and see if it fixes it. If it does - bingo!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/06/29/mysql-and-foreign-keys/">MySQL and Foreign Keys</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-29T23:25:40+01:00" pubdate data-updated="true">Jun 29<span>th</span>, 2011</time>
        
         | <a href="/2011/06/29/mysql-and-foreign-keys/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is to remind me next time that MySQL isn’t as clever as you think it might be.</p>

<p>If you have Table A, with column 1, 2, 3 and Table B with columns 4, 5, 6 – Primary keys are columns 1 &amp; 4 respectively.</p>

<p>Now you want to add a foreign key to table B, column 6, referencing column 1 in table A. No problem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">`</span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tableB</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">fk_column_1</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">column6</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tableA</span> <span class="p">(</span><span class="n">column1</span><span class="p">);</span><span class="o">`</span>
</span></code></pre></td></tr></table></div></figure>


<p>oh dear, fails with something like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">`</span><span class="n">ERROR</span> <span class="mi">1005</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">Can</span><span class="s1">&#39;t create table &#39;</span><span class="p">.</span><span class="o">/</span><span class="n">databasename</span><span class="o">/#</span><span class="k">sql</span><span class="o">-</span><span class="mi">55</span><span class="n">d1_b07</span><span class="p">.</span><span class="n">frm</span><span class="err">&#39;</span> <span class="p">(</span><span class="n">errno</span><span class="p">:</span> <span class="mi">150</span><span class="p">)</span><span class="o">`</span>
</span></code></pre></td></tr></table></div></figure>


<p>This fails because creating the primary key on columns 1 and 4 don’t automatically create indexes on those columns, and adding a foreign key requires there to be an index on the column you are referencing. Boom!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/05/24/rush-monday-16th-may-setlist-time-machine-tour/">Rush - Monday 16th May Setlist - Time Machine Tour</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-24T21:45:24+01:00" pubdate data-updated="true">May 24<span>th</span>, 2011</time>
        
         | <a href="/2011/05/24/rush-monday-16th-may-setlist-time-machine-tour/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Fantastic night at the Sheffield Arena seeing Rush..</p>

<ul>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/The_Spirit_of_Radio">The Spirit of Radio</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Time_Stand_Still_(song">Time Stand Still</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Presto_(album">Presto</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Stick_It_Out_(Rush_song">Stick It Out</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Workin%27_Them_Angels">Workin&#8217; Them Angels</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/List_of_Rush_instrumentals">Leave That Thing Alone</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Snakes_And_Arrows">Faithless</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/BU2B">BU2B</a>&#8221; (from <em><a href="http://en.wikipedia.org/wiki/Clockwork_Angels">Clockwork Angels</a></em>)</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Freewill_(song">Freewill</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Power_Windows_(album">Marathon</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Subdivisions_(song">Subdivisions</a>)&#8221;</p></li>
</ul>


<p><strong>Intermission</strong></p>

<ul>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Tom_Sawyer_(song">Tom Sawyer</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Red_Barchetta">Red Barchetta</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/YYZ_(song">YYZ</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Limelight_(song">Limelight</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Moving_Pictures_(album">The Camera Eye</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Moving_Pictures_(album">Witch Hunt</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Vital_Signs_(song">Vital Signs</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Caravan_(Rush_song">Caravan</a>)&#8221; (from <em>Clockwork Angels</em>)</p></li>
<li><p>&#8220;Love 4 Sale&#8221; (Drum solo)</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Closer_To_The_Heart">Closer To The Heart</a>&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/2112_(song">2112 Overture / The Temples of Syrinx</a>)&#8221;</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Far_Cry_(Rush_song">Far Cry</a>)&#8221;</p></li>
</ul>


<p><strong>Encore:</strong></p>

<ul>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/La_Villa_Strangiato">La Villa Strangiato</a>&#8221; (with polka intro)</p></li>
<li><p>&#8220;<a href="http://en.wikipedia.org/wiki/Working_Man">Working Man</a>&#8221; (with reggae intro and <a href="http://en.wikipedia.org/wiki/Cygnus_X-1_duology">Cygnus X-1: Book I</a> outro)</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/06/the-scala-momentum-builds/">The Scala Momentum Builds&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-06T13:01:22+01:00" pubdate data-updated="true">Apr 6<span>th</span>, 2011</time>
        
         | <a href="/2011/04/06/the-scala-momentum-builds/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Scala is a relatively new programming language, which runs on the Java Virtual Machine and has very good interoperability with the Java Language.</p>

<p>Here is the blurb from <a href="http://www.scala-lang.org/">the official site</a></p>

<p>&#8220;Scala is a general purpose programming language designed to express common programming patterns in a concise, elegant, and type-safe way. It smoothly integrates features of object-oriented and functional languages, enabling Java and other programmers to be more productive. Code sizes are typically reduced by a factor of two to three when compared to an equivalent Java application.&#8221;</p>

<p>The bit which gets managers excited is the bit where it says &#8220;more productive&#8221;, the bit which gets technical architects excited is the bit where it says &#8220;smoothly integrates&#8221; and the bits which get developers excited is all of it!</p>

<p>Some people see Scala being the natural successor to Java, indeed some of our developers have spent a little bit of time having a look at the language and the main web framework, <a href="http://liftweb.net/">Lift</a>. <a href="http://seventhings.liftweb.net/">This sells lift pretty well</a>.</p>

<p>So, why post about it - well, as well as Scala being something we should be looking at, I spotted a <a href="http://www.infoq.com/articles/guardian_scala">great blog post</a> talking about how the Guardian newspaper have started using Scala. Once they started, they couldn&#8217;t stop! I like this bit:</p>

<p>&#8220;After about four weeks of writing just the tests in Scala, we got fed up of having to write the main code in Java, and decided to convert the whole lot to Scala.&#8221;</p>

<p>and this bit was a real eye opener:</p>

<p>&#8220;The core Java platform that delivers <a href="http://www.guardian.co.uk">www.guardian.co.uk</a> has a full release every two weeks. Compared with many enterprise Java applications, this is excellent. Compared with other websites, it&#8217;s very poor.&#8221;</p>

<p>Food for thought people, food for thought&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/09/using-constants-in-spring-configuration/">Using Constants in Spring Configuration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-09T13:36:24+00:00" pubdate data-updated="true">Mar 9<span>th</span>, 2011</time>
        
         | <a href="/2011/03/09/using-constants-in-spring-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Whilst doing some re-work on a loan calculator, I wanted to move the configuration of the various loan rates in to the spring XML configuration. Setting up the various loan rates for the amount borrowed is relatively straightforward, but I wanted to use constants (defined only once in the app) in the map rather than straight strings. Easy you may say.. and indeed, it is if you use the &#8216;util&#8217; schema.</p>

<p>Add the util schema to your bean configuration xml</p>

<pre><code>beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:util="http://www.springframework.org/schema/util"
xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/util
http://www.springframework.org/schema/util/spring-util-3.0.xsd"
</code></pre>

<p>and then you can just reference your constants as follows:&#8220;</p>

<pre><code>util:constant static-field="com.foo.bar.RATE_2000_2950"
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/06/testing-the-grails-spring-security-ldap-combo/">Testing the Grails, Spring Security, LDAP Combo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-06T16:00:46+00:00" pubdate data-updated="true">Jan 6<span>th</span>, 2011</time>
        
         | <a href="/2011/01/06/testing-the-grails-spring-security-ldap-combo/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For running unit tests &amp; integration tests, you might not want to run against an existing LDAP directory, maybe because you&#8217;re working remotely, or because you want a disposable directory to throw away after you&#8217;ve run your tests. Well, there is a <a href="http://www.grails.org/plugin/ldap-server">grails plugin</a> which adds an embedded LDAP directory (ApacheDS) to your application which can be fired up as/when required.</p>

<p>After installing the plugin, it requires a bit of configuration, so in your Config.groovy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">environments</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">development</span> <span class="o">{</span>       
</span><span class='line'>      <span class="c1">// Embedded ldap server </span>
</span><span class='line'>      <span class="n">ldapServers</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">d1</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;dc=people,dc=companyname,dc=int&quot;</span>
</span><span class='line'>              <span class="n">port</span> <span class="o">=</span> <span class="mi">10389</span>
</span><span class='line'>              <span class="n">indexed</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;objectClass&quot;</span><span class="o">,</span> <span class="s2">&quot;uid&quot;</span><span class="o">,</span> <span class="s2">&quot;mail&quot;</span><span class="o">,</span> <span class="s2">&quot;userPassword&quot;</span><span class="o">]</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">grails</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">springsecurity</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">server</span> <span class="o">=</span> <span class="s1">&#39;ldap://localhost:10389&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="o">....</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now, when the app is instantiated in the development environment, you have an ldap directory running on localhost, post 10389. You might want to change what is indexed depending on what details you actually want indexing!</p>

<p>If you wanted some default data loaded when the ldap server starts, simply add an ldif file to the grails-app/ldap-servers/d1/data directory. This gets auto loaded:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="nl">dn:</span> <span class="n">ou</span><span class="o">=</span><span class="n">group</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">top</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalUnit</span>
</span><span class='line'><span class="nl">ou:</span> <span class="n">group</span>
</span><span class='line'>
</span><span class='line'><span class="nl">dn:</span> <span class="n">ou</span><span class="o">=</span><span class="n">People</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalUnit</span>
</span><span class='line'><span class="nl">ou:</span> <span class="n">People</span>
</span><span class='line'>
</span><span class='line'><span class="nl">dn:</span> <span class="n">uid</span><span class="o">=</span><span class="n">jjefferies</span><span class="o">,</span><span class="n">ou</span><span class="o">=</span><span class="n">People</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">uid:</span> <span class="n">jjefferies</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">uidObject</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">top</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">person</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalPerson</span>
</span><span class='line'><span class="nl">cn:</span> <span class="n">James</span> <span class="n">Jefferies</span>
</span><span class='line'><span class="nl">sn:</span> <span class="n">Jefferies</span>
</span><span class='line'><span class="nl">userPassword:</span> <span class="o">{</span><span class="n">SHA</span><span class="o">}</span><span class="n">ERnP637iUzV</span><span class="o">+</span><span class="n">A0oI2ETuol9v0g8</span><span class="o">=</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>To run unit tests against it, a reference to the server get&#8217;s injected in to your test class and then you can run some tests against it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="kd">class</span> <span class="nc">LdapTests</span> <span class="kd">extends</span> <span class="n">GroovyTestCase</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">def</span> <span class="n">d1LdapServer</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kt">void</span> <span class="nf">testLdapServerShouldExist</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">assert</span> <span class="n">d1LdapServer</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="s2">&quot;uid=jjefferies,ou=People,dc=people,dc=companyname,dc=int&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">testJJUserIsThere</span><span class="o">()</span> <span class="o">{</span>        
</span><span class='line'>      <span class="kt">def</span> <span class="n">user</span> <span class="o">=</span> <span class="n">d1LdapServer</span><span class="o">[</span><span class="s2">&quot;uid=jjefferies,ou=People,dc=people,dc=companyname,dc=int&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">assert</span> <span class="s2">&quot;James Jefferies&quot;</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="na">cn</span><span class="o">.</span><span class="na">first</span><span class="o">()</span> <span class="c1">// cn is a multi valued string attribute       </span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>If you&#8217;re doing the full spring security with custom rolled retrieval of Roles and you want to test it, then you need to make sure you&#8217;ve bootstrapped those users too, so that the roles are retrieved as well as the user being authenticated.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/06/grails-spring-security-ldap/">Grails, Spring Security & Ldap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-06T15:25:32+00:00" pubdate data-updated="true">Jan 6<span>th</span>, 2011</time>
        
         | <a href="/2011/01/06/grails-spring-security-ldap/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At work we&#8217;re building a grails application which needs to authenticate users against our internal user directory using LDAP (Lightweight Directory something-or-other Protocol). Grails has two fantastic plugins to help here:</p>

<ol>
<li>Spring security plugin</li>
<li>Spring security LDAP plugin</li>
</ol>


<p>Now, getting the LDAP plugin to work has proved somewhat problematic, partially because of me rushing ahead, partially because documentation isn&#8217;t quite as good as it could be. So to get the application to authenticate users with LDAP, there are two main ways of doing it.</p>

<ol>
<li>Password comparison (where you have to do your own password encoding)</li>
<li>Bind authentication (where you pass on the username and password and let the LDAP directory authenticate)</li>
</ol>


<p>for some daft reason, I started off down the Password comparison route, which was made more problematic when I found out that our internal LDAP directory uses an archaic form of password encryption. Once I&#8217;d stopped and re-read the documentation, a little light came on in my head and I started trying to get it to work with Bind authentication - then it doesn&#8217;t matter how the password is encrypted, you&#8217;re delegating that task.</p>

<p>The other part of the requirement is that the roles which will be retrieved following authentication will be from the application database (initially anyway) rather than the LDAP directory using a userDetailsService. So, to get everything working, the various Spring components need configuring manually, rather than relying on the plug in to do it.</p>

<p>So - how did I get it working against a real LDAP directory once the Spring Security &amp; LDAP plugins are installed?</p>

<p>Well, first, in the application configuration, set the ldap context:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>grails.plugins.springsecurity.ldap.context.server <span class="o">=</span> <span class="s1">&#39;ldap://this is the ip address of my ldap directory:this is the port used&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, in the resources.groovy spring configuration file, set up the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">beans</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>     <span class="c1">// this gives the pattern for authenticating the user, as the user doesn&#39;t want to enter the whole thing, </span>
</span><span class='line'>     <span class="c1">// just their unique id</span>
</span><span class='line'>     <span class="n">myLdapAuthenticator</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">BindAuthenticator</span><span class="o">,</span> <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;contextSource&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">userDnPatterns</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;uid={0},ou=People,dc=people,dc=somewhereorother,dc=int&#39;</span><span class="o">]</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// this overrides the default Authentication Provider with our authenticator and our user details service</span>
</span><span class='line'>     <span class="n">ldapAuthProvider</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">LdapAuthenticationProvider</span><span class="o">,</span>
</span><span class='line'>        <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;myLdapAuthenticator&quot;</span><span class="o">),</span>
</span><span class='line'>        <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;userDetailsService&quot;</span><span class="o">)</span>
</span><span class='line'>     <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// defining our user details service</span>
</span><span class='line'>     <span class="n">userDetailsService</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">companyname</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">UserDetailsService</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now, when the application is started, spring security knows it needs to use LDAP to do it&#8217;s business and once it&#8217;s authenticated, it needs to use our user details service to return the list of roles. Hurrah!</p>

<p>PS - nearly forgot - to use the userDetailsService for retrieving the roles, it has to implement the org.springframework.security.ldap.userdetails.LdapAuthoritiesPopulator interface, returning a collection of org.springframework.security.core.GrantedAuthority</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/08/16/parse-train-describer-csv-data/">Parse Train Describer CSV Data</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/16/build-a-network-rail-data-feed-teletyper/">Build A Network Rail Data Feed Teletyper</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/14/before-you-buy-a-berg-little-printer-dot-dot-dot/">Before you buy a Berg Little Printer&#8230;</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/07/importing-network-rail-train-movement-feeds-into-mongodb/">Importing Network Rail Train Movement feeds into MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/01/moving-from-wordpress-to-octopress/">Moving from WordPress to Octopress</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jamesjefferies">@jamesjefferies</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesjefferies',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shedcode", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shedcode" class="twitter-follow-button" data-show-count="false">Follow @shedcode</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - James Jefferies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesjefferiesblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
