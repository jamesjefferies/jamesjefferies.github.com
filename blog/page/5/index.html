
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Jefferies and ShedCode Ltd</title>
  <meta name="author" content="James Jefferies">
  <meta name="google-site-verification" content="x0Mk5K7-ZW7IoUe7Xczv5TvjRygnWGAboUyzxMYYDm0" />
  
  <meta name="description" content="For running unit tests &amp; integration tests, you might not want to run against an existing LDAP directory, maybe because you&#8217;re working &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesjefferies.com/blog/page/5/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href='http://fonts.googleapis.com/css?family=Bevan' rel='stylesheet' type='text/css'>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Jefferies and ShedCode Ltd" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3110855-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Jefferies and ShedCode Ltd</a></h1>
  
    <h2>The world of James and ShedCode</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesjefferies.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="http://shedcode.co.uk/">ShedCode</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/06/testing-the-grails-spring-security-ldap-combo/">Testing the Grails, Spring Security, LDAP Combo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-06T16:00:46+00:00" pubdate data-updated="true">Jan 6<span>th</span>, 2011</time>
        
         | <a href="/2011/01/06/testing-the-grails-spring-security-ldap-combo/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For running unit tests &amp; integration tests, you might not want to run against an existing LDAP directory, maybe because you&#8217;re working remotely, or because you want a disposable directory to throw away after you&#8217;ve run your tests. Well, there is a <a href="http://www.grails.org/plugin/ldap-server">grails plugin</a> which adds an embedded LDAP directory (ApacheDS) to your application which can be fired up as/when required.</p>

<p>After installing the plugin, it requires a bit of configuration, so in your Config.groovy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">environments</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">development</span> <span class="o">{</span>       
</span><span class='line'>      <span class="c1">// Embedded ldap server </span>
</span><span class='line'>      <span class="n">ldapServers</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">d1</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;dc=people,dc=companyname,dc=int&quot;</span>
</span><span class='line'>              <span class="n">port</span> <span class="o">=</span> <span class="mi">10389</span>
</span><span class='line'>              <span class="n">indexed</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;objectClass&quot;</span><span class="o">,</span> <span class="s2">&quot;uid&quot;</span><span class="o">,</span> <span class="s2">&quot;mail&quot;</span><span class="o">,</span> <span class="s2">&quot;userPassword&quot;</span><span class="o">]</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">grails</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">springsecurity</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">server</span> <span class="o">=</span> <span class="s1">&#39;ldap://localhost:10389&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="o">....</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now, when the app is instantiated in the development environment, you have an ldap directory running on localhost, post 10389. You might want to change what is indexed depending on what details you actually want indexing!</p>

<p>If you wanted some default data loaded when the ldap server starts, simply add an ldif file to the grails-app/ldap-servers/d1/data directory. This gets auto loaded:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="nl">dn:</span> <span class="n">ou</span><span class="o">=</span><span class="n">group</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">top</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalUnit</span>
</span><span class='line'><span class="nl">ou:</span> <span class="n">group</span>
</span><span class='line'>
</span><span class='line'><span class="nl">dn:</span> <span class="n">ou</span><span class="o">=</span><span class="n">People</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalUnit</span>
</span><span class='line'><span class="nl">ou:</span> <span class="n">People</span>
</span><span class='line'>
</span><span class='line'><span class="nl">dn:</span> <span class="n">uid</span><span class="o">=</span><span class="n">jjefferies</span><span class="o">,</span><span class="n">ou</span><span class="o">=</span><span class="n">People</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">people</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="n">companyname</span><span class="o">,</span><span class="n">dc</span><span class="o">=</span><span class="kt">int</span>
</span><span class='line'><span class="nl">uid:</span> <span class="n">jjefferies</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">uidObject</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">top</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">person</span>
</span><span class='line'><span class="nl">objectClass:</span> <span class="n">organizationalPerson</span>
</span><span class='line'><span class="nl">cn:</span> <span class="n">James</span> <span class="n">Jefferies</span>
</span><span class='line'><span class="nl">sn:</span> <span class="n">Jefferies</span>
</span><span class='line'><span class="nl">userPassword:</span> <span class="o">{</span><span class="n">SHA</span><span class="o">}</span><span class="n">ERnP637iUzV</span><span class="o">+</span><span class="n">A0oI2ETuol9v0g8</span><span class="o">=</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>To run unit tests against it, a reference to the server get&#8217;s injected in to your test class and then you can run some tests against it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="kd">class</span> <span class="nc">LdapTests</span> <span class="kd">extends</span> <span class="n">GroovyTestCase</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">def</span> <span class="n">d1LdapServer</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kt">void</span> <span class="nf">testLdapServerShouldExist</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">assert</span> <span class="n">d1LdapServer</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="s2">&quot;uid=jjefferies,ou=People,dc=people,dc=companyname,dc=int&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">testJJUserIsThere</span><span class="o">()</span> <span class="o">{</span>        
</span><span class='line'>      <span class="kt">def</span> <span class="n">user</span> <span class="o">=</span> <span class="n">d1LdapServer</span><span class="o">[</span><span class="s2">&quot;uid=jjefferies,ou=People,dc=people,dc=companyname,dc=int&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">assert</span> <span class="s2">&quot;James Jefferies&quot;</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="na">cn</span><span class="o">.</span><span class="na">first</span><span class="o">()</span> <span class="c1">// cn is a multi valued string attribute       </span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>If you&#8217;re doing the full spring security with custom rolled retrieval of Roles and you want to test it, then you need to make sure you&#8217;ve bootstrapped those users too, so that the roles are retrieved as well as the user being authenticated.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/06/grails-spring-security-ldap/">Grails, Spring Security & Ldap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-06T15:25:32+00:00" pubdate data-updated="true">Jan 6<span>th</span>, 2011</time>
        
         | <a href="/2011/01/06/grails-spring-security-ldap/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At work we&#8217;re building a grails application which needs to authenticate users against our internal user directory using LDAP (Lightweight Directory something-or-other Protocol). Grails has two fantastic plugins to help here:</p>

<ol>
<li>Spring security plugin</li>
<li>Spring security LDAP plugin</li>
</ol>


<p>Now, getting the LDAP plugin to work has proved somewhat problematic, partially because of me rushing ahead, partially because documentation isn&#8217;t quite as good as it could be. So to get the application to authenticate users with LDAP, there are two main ways of doing it.</p>

<ol>
<li>Password comparison (where you have to do your own password encoding)</li>
<li>Bind authentication (where you pass on the username and password and let the LDAP directory authenticate)</li>
</ol>


<p>for some daft reason, I started off down the Password comparison route, which was made more problematic when I found out that our internal LDAP directory uses an archaic form of password encryption. Once I&#8217;d stopped and re-read the documentation, a little light came on in my head and I started trying to get it to work with Bind authentication - then it doesn&#8217;t matter how the password is encrypted, you&#8217;re delegating that task.</p>

<p>The other part of the requirement is that the roles which will be retrieved following authentication will be from the application database (initially anyway) rather than the LDAP directory using a userDetailsService. So, to get everything working, the various Spring components need configuring manually, rather than relying on the plug in to do it.</p>

<p>So - how did I get it working against a real LDAP directory once the Spring Security &amp; LDAP plugins are installed?</p>

<p>Well, first, in the application configuration, set the ldap context:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>grails.plugins.springsecurity.ldap.context.server <span class="o">=</span> <span class="s1">&#39;ldap://this is the ip address of my ldap directory:this is the port used&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, in the resources.groovy spring configuration file, set up the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">beans</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>     <span class="c1">// this gives the pattern for authenticating the user, as the user doesn&#39;t want to enter the whole thing, </span>
</span><span class='line'>     <span class="c1">// just their unique id</span>
</span><span class='line'>     <span class="n">myLdapAuthenticator</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">BindAuthenticator</span><span class="o">,</span> <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;contextSource&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">userDnPatterns</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;uid={0},ou=People,dc=people,dc=somewhereorother,dc=int&#39;</span><span class="o">]</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// this overrides the default Authentication Provider with our authenticator and our user details service</span>
</span><span class='line'>     <span class="n">ldapAuthProvider</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">LdapAuthenticationProvider</span><span class="o">,</span>
</span><span class='line'>        <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;myLdapAuthenticator&quot;</span><span class="o">),</span>
</span><span class='line'>        <span class="n">ref</span><span class="o">(</span><span class="s2">&quot;userDetailsService&quot;</span><span class="o">)</span>
</span><span class='line'>     <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// defining our user details service</span>
</span><span class='line'>     <span class="n">userDetailsService</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">companyname</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">UserDetailsService</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now, when the application is started, spring security knows it needs to use LDAP to do it&#8217;s business and once it&#8217;s authenticated, it needs to use our user details service to return the list of roles. Hurrah!</p>

<p>PS - nearly forgot - to use the userDetailsService for retrieving the roles, it has to implement the org.springframework.security.ldap.userdetails.LdapAuthoritiesPopulator interface, returning a collection of org.springframework.security.core.GrantedAuthority</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/29/how-big-are-my-mysql-tables/">How Big Are My MySQL Tables?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-29T13:41:15+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2010</time>
        
         | <a href="/2010/12/29/how-big-are-my-mysql-tables/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>You may ask yourself this question - here is a little query from <a href="http://www.mysqlperformanceblog.com/">MySQL performance blog</a> which may well help:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">TABLES</span><span class="p">,</span>
</span><span class='line'><span class="k">TABLE_NAME</span><span class="p">,</span>
</span><span class='line'><span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">table_rows</span><span class="p">)</span><span class="o">/</span><span class="mi">1000000</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="k">rows</span><span class="p">,</span>
</span><span class='line'><span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">data_length</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;G&#39;</span><span class="p">)</span> <span class="k">DATA</span><span class="p">,</span>
</span><span class='line'><span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">index_length</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;G&#39;</span><span class="p">)</span> <span class="n">idx</span><span class="p">,</span>
</span><span class='line'><span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">data_length</span><span class="o">+</span><span class="n">index_length</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;G&#39;</span><span class="p">)</span> <span class="n">total_size</span><span class="p">,</span>
</span><span class='line'><span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">index_length</span><span class="p">)</span><span class="o">/</span><span class="k">sum</span><span class="p">(</span><span class="n">data_length</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="n">idxfrac</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">TABLES</span>
</span><span class='line'><span class="k">group</span> <span class="k">by</span> <span class="k">TABLE_NAME</span>
</span><span class='line'><span class="k">order</span> <span class="k">by</span> <span class="n">total_size</span> <span class="k">desc</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/29/getting-spring-and-liquibase-to-play-nicely/">Getting Spring and Liquibase to Play Nicely</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-29T11:08:40+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2010</time>
        
         | <a href="/2010/12/29/getting-spring-and-liquibase-to-play-nicely/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Liquibase comes with out of the box Spring integration, although there are few configuration options if you take this route. Straight after your web application is deployed, the Spring container will start - as it starts, it runs the Liquibase database migrations before the application is fully instantiated.</p>

<p>Getting it working with v2.0.0 proved problematic, the way you get it working is to add the following to your Spring context (note clazz should be class, but is messes up the markup!)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;liquibase&quot;</span> <span class="na">clazz=</span><span class="s">&quot;liquibase.integration.spring.SpringLiquibase&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;changeLog&quot;</span> <span class="na">value=</span><span class="s">&quot;classpath:db/changelog-master.xml&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;contexts&quot;</span> <span class="na">value=</span><span class="s">&quot;test, production&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/bean&gt;</span>   
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>which is all well and good, except the SpringLiquibase class crashes on instantiation - it&#8217;s expecting a map named &#8216;parameters&#8217; to exist. Unfortunately, when you try and inject the map in to the class, that fails too as the Map can&#8217;t be set externally&#8230; looking at the code, you can see where it&#8217;s going wrong - fortunately, it has been fixed in the latest overnight snapshot build, so instead of using v2.0.0 I&#8217;m now using V2.0.1.SNAPSHOT</p>

<p>I could have created my own implementation of SpringLiquibase - in fact this would have been my next step, but for now I&#8217;ll stick with the updated snapshot.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/14/liquibase-and-the-maven-plugin/">Liquibase and the Maven Plugin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-14T16:40:04+00:00" pubdate data-updated="true">Dec 14<span>th</span>, 2010</time>
        
         | <a href="/2010/12/14/liquibase-and-the-maven-plugin/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m having a look at the <a href="http://liquibase.org/home">Liquibase</a> product at the mo, mainly to help automate the database migrations for one of our clients. Currently the process is a bit hairy and manual. It&#8217;s easy to make mistakes and you have to be on the ball, plus rollbacks are awkard and generally it&#8217;s a mess.</p>

<p>Liquibase is a Database Change Management system - as they say &#8220;You never develop code without version control, why do you develop your database without it?&#8221; - and I agree.</p>

<p>However, in classic Open Source fashion, the documentation leaves something to be desired. So when I found myself trusting the documentation and getting the error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>The driver has not been specified either as a parameter or in a properties file
</span></code></pre></td></tr></table></div></figure>


<p>when it was specified in both properties and as a parameter I should have realised that it was the documentation which was wrong, not me. I&#8217;m far too trusting&#8230;.</p>

<p>So, when you set up the maven plugin in and they recommend doing this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>  <span class="nt">&lt;groupid&gt;</span>org.liquibase<span class="nt">&lt;/groupid&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactid&gt;</span>liquibase-plugin<span class="nt">&lt;/artifactid&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>1.6.1.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>          <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;phase&gt;</span>process-resources<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                          <span class="nt">&lt;propertyfile&gt;</span>src/main/resources/liquibase.properties<span class="nt">&lt;/propertyfile&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                          <span class="nt">&lt;goal&gt;</span>update<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'><span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>you just ignore them as the configuration is only set for that particular phase - whereas you want the configuration for all phases.. so you should set it up like this instead, makes a lot of sense really.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>        <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupid&gt;</span>org.liquibase<span class="nt">&lt;/groupid&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactid&gt;</span>liquibase-plugin<span class="nt">&lt;/artifactid&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>1.9.3.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                <span class="nt">&lt;propertyfile&gt;</span>src/main/resources/liquibase.properties<span class="nt">&lt;/propertyfile&gt;</span>
</span><span class='line'>                <span class="nt">&lt;changelogfile&gt;</span>src/main/resources/db/changelog-master.xml<span class="nt">&lt;/changelogfile&gt;</span>
</span><span class='line'>                <span class="nt">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver&gt;</span>
</span><span class='line'>                <span class="nt">&lt;url&gt;</span>${db-connection-url}<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>                <span class="nt">&lt;username&gt;</span>${db-connection-username}<span class="nt">&lt;/username&gt;</span>
</span><span class='line'>                <span class="nt">&lt;password&gt;</span>${db-connection-password}<span class="nt">&lt;/password&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>            <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>                <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;phase&gt;</span>process-resources<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;goal&gt;</span>update<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>hurrah.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/01/set-list-for-british-sea-power-at-fibbers-october-4th-2010/">Set List for British Sea Power at Fibbers - October 4th 2010</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-01T22:06:24+00:00" pubdate data-updated="true">Nov 1<span>st</span>, 2010</time>
        
         | <a href="/2010/11/01/set-list-for-british-sea-power-at-fibbers-october-4th-2010/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lights Out For Darker Skies</p>

<p>Remember me</p>

<p>Canvey Island</p>

<p>Pyrex</p>

<p>Atom</p>

<p>Zeus</p>

<p>Bear</p>

<p>Blackout</p>

<p>Down On the Ground</p>

<p>Can we do it</p>

<p>Waving Flags</p>

<p>Skua</p>

<p>St Louis</p>

<p>Lucifer</p>

<p>Glitter</p>

<p>Carrion</p>

<p>Rock in A</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/10/14/maven-gets-an-update-3-0/">Maven Gets an Update - 3.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-14T11:17:33+01:00" pubdate data-updated="true">Oct 14<span>th</span>, 2010</time>
        
         | <a href="/2010/10/14/maven-gets-an-update-3-0/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Maven is the build &amp; dependency management tool we use for all our java projects. Used correctly it&#8217;s ace, but it can also prove to be a headache when you head off the beaten track.</p>

<p>Maven 3.0 has just been released which contains a lot of new goodies, plus, alleged backwards compatibility!</p>

<p>The pom file, which is the main file which describes the structure of the project, it&#8217;d dependencies and plugins <em>is</em> backwards compatible, but there is stricter validation. So when I ran one of our project configuration files through the new version, it came up with a number of missing versions and scopes in the wrong place. Easy to fix and the config still works with version 2 or 3. Bigger and more complicated project structures may have more problems.</p>

<p>The two things I think are most interesting are:</p>

<ul>
<li><p>When an error occurs, rather than just spitting out an error message, a link is included to a wiki page, what a great idea! For example:</p>

<p>[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] <a href="http://cwiki.apache.org/confluence/display/MAVEN/NoGoalSpecifiedException">http://cwiki.apache.org/confluence/display/MAVEN/NoGoalSpecifiedException</a></p></li>
<li><p>The maven shell has been updated, the shell is a high performance console add on, giving you syntax highlighting and context sensitive help. At the mo you can download and <a href="http://github.com/sonatype/mvnsh">install it from github </a></p></li>
</ul>


<p>I&#8217;ll be taking it out for a spin with some of our projects to see if there any issues, before we maybe have a look at some of our other projects.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/08/why-has-my-jsf-button-stopped-working/">Why Has My JSF Button Stopped Working..</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-08T14:44:01+01:00" pubdate data-updated="true">Jun 8<span>th</span>, 2010</time>
        
         | <a href="/2010/06/08/why-has-my-jsf-button-stopped-working/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve asked this a number of times in the past, but I think I&#8217;ve  finally found the answer!</p>

<p>Often with JSF you may have a command  button wrapped in a div or subview rendered only in certain  circumstances.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;f:subview</span> <span class="na">id=</span><span class="s">&quot;show-the-button&quot;</span> <span class="na">rendered=</span><span class="s">&quot;#{managedBean.shouldButtonBeRendered}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h:commandButton</span> <span class="na">action=</span><span class="s">&quot;#{managedBean.doSomething}&quot;</span> <span class="na">value=</span><span class="s">&quot;Do Something&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/f:subview&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok, you might have some extra mark up in there, id etc, but this is  just to keep things simple for this example.</p>

<p>Now, for the button  to be rendered, the value of  managedBean.shouldButtonBeRendered should  be true when the page is being rendered, then the button appears.</p>

<p>However,  if between the page loading and the button being clicked, the value of  managedBean.shouldButtonBeRendered changes, then the button action is  ignored. Many hours of headaches would have been saved if I&#8217;d realised this sooner!</p>

<p>So, if you have a button which stops working under certain circumstances, check any rendering on the component or parent components!</p>

<p>More info can be found on the <a href="http://forums.sun.com/thread.jspa?threadID=5410200">sun forums</a> and on <a href="http://balusc.blogspot.com/2010/06/benefits-and-pitfalls-of-viewscoped.html">BalusC&#8217;s</a> useful site</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/06/baby-kit-recommendations-part-2/">Baby Kit Recommendations – Part 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-06T20:11:12+01:00" pubdate data-updated="true">Jun 6<span>th</span>, 2010</time>
        
         | <a href="/2010/06/06/baby-kit-recommendations-part-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In all the rush of our baby arriving, we didn&#8217;t feel able to start with re-usable nappies, but once we got in to the swing of things, we wanted to try a few different varieties to see what suited us most. Our pick of the bunch are the <a href="http://www.babame.com/flip.php">flip nappies</a>.</p>

<p>They are fab. We have two different liners, the super dry ones and the organic cloth ones. They both do the trick and although the organic ones are a bit bulkier, they both seem pretty absorbent.</p>

<p>Adjustable? Yup, from little nippers up to big nippers&#8230; For the record, we started with Tesco&#8217;s disposables. Although I can&#8217;t stand Tesco, they got the good reviews and are good value. Wouldn&#8217;t want to go back now though!</p>

<p><img src="http://www.babame.com/images/flip_reusable_nappies.jpg" alt="flip nappies" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/06/06/baby-kit-recommendations-part-1/">Baby Kit Recommendations – Part 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-06T19:58:50+01:00" pubdate data-updated="true">Jun 6<span>th</span>, 2010</time>
        
         | <a href="/2010/06/06/baby-kit-recommendations-part-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So when little nipper was born, we initially used cotton wool and warm water for all wiping up incidents. No nasty chemicals and worked a treat.. after a couple of weeks though, baby skin can cope with a bit more, so we switched to the pack of disposable wipes we&#8217;d been given in our baby welcome pack. They worked fine but just seemed a bit.. well, disposable and wasteful. This is where <a href="http://www.cheekywipes.com">cheeky wipes</a> come in.
<img src="http://www.cheekywipes.com/images/cw/Opened_Kit_Sml.jpg" alt="Cheeky Wipes" /></p>

<p>They are brilliant. They&#8217;re nice cotton squares complete with dirty and clean tubs and potions. You soak the clean ones in the clean tub with the clean potion, and the dirty go in the dirty tub with the dirty potion. Fantastic, the dirty potion is anti-bacterial and when it&#8217;s full, you pull the drawstring and chuck them in the washing machine.</p>

<p>Travel bags are also provided and our top tip is to leave the squares out in the sunshine to dry as the sun bleaches them, removing any stains.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/11/11/steam-powered-arduino-part-1/">Steam powered Arduino part 1</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/28/a-great-idea-for-amazon-deliveries/">A great idea for Amazon deliveries</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/16/scenic-railways-our-railway-hack/">Scenic Railways - our railway hack</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/16/railway-hackday-off-the-rails/">Railway Hackday - Off The Rails</a>
      </li>
    
      <li class="post">
        <a href="/2012/09/30/tech-companies-accelerate-your-employees/">Tech companies - accelerate your employees</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jamesjefferies">@jamesjefferies</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jamesjefferies',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shedcode", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shedcode" class="twitter-follow-button" data-show-count="false">Follow @shedcode</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - James Jefferies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jamesjefferiesblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
