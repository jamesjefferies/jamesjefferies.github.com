
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="When using Tomahawk&#8217;s file upload component it isn&#8217;t obvious how to catch what happens when you blow the file size limit. The file limit &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jamesjefferies.github.com/blog/page/6/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jamesjefferies.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/05/27/catching-file-size-exceeded-when-using-tomahawk-file-upload-component/">Catching &#039;file Size Exceeded&#039; When Using Tomahawk File Upload Component</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-27T11:22:40+01:00" pubdate data-updated="true">May 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When using T<a href="http://myfaces.apache.org/tomahawk-project/tomahawk12/tagdoc/t_inputFileUpload.html">omahawk&#8217;s file upload component</a> it isn&#8217;t obvious how to catch what happens when you blow the file size limit. The file limit is set in the web.xml configuration for Tomahawk, i.e.</p>


<p><code>  &lt;filter&gt;
&lt;filter-name&gt;extensionsFilter&lt;/filter-name&gt;
&lt;filter-class&gt;org.apache.myfaces.webapp.filter.ExtensionsFilter&lt;/filter-class&gt;
&lt;init-param&gt;
&lt;description&gt;</p>

<pre><code>Set the size limit for uploaded files. Format: 10 - 10
bytes 10k - 10 KB 10m - 10 MB 1g - 1 GB
</code></pre>

<p>&lt;/description&gt;
&lt;param-name&gt;uploadMaxFileSize&lt;/param-name&gt;
&lt;param-value&gt;10m&lt;/param-value&gt;
&lt;/init-param&gt;</p>

<pre><code>.....
</code></pre>

<p>&lt;/filter&gt;</code></p>

<p>Here you can see the limit is set to 10 meg.</p>


<p> <p>So by default, if you blow the limit, the component fails silently.. or does it?</p> <p>Well, the component actually adds a couple of attributes to the request when refreshing the page (following the click of the upload button). The attributes are:</p> <pre><span>org.apache.myfaces.custom.fileupload.exception</span><span>
org.apache.myfaces.custom.fileupload.maxSize</span></pre><p>by checking the request (during the page render) you can grab these attributes, if set, and display something meaningful to the user. You could have a little render tag at the top of the page to ensure the attributes are checked. Whilst this is a bit cronky, it is one of the jsf workarounds which does work.. in a fashion.</p> <p>If they are present and you want to display the max size to the user, then apache commons FileUtils comes along to save the day</p>
<code><a href="http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#byteCountToDisplaySize(long)">org.apache.commons.io.FileUtils.byteCountToDisplaySize</a>(new Long(maxSizeFromRequestAttribute));</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/05/01/deploying-applications-to-tomcat-running-under/">Deploying Applications to Tomcat Running Under /</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-01T11:22:15+01:00" pubdate data-updated="true">May 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Standard practice with tomcat is that the application is deployed under a directory which is derived from the name of the war file archive which is deployed.</p>

<p>i.e. foo.war will be deployed to the foo directory and will be accessed with the URL http://application-server-url/foo</p>

<p>All well and good, but what if you want to access it as http://app-server-url/   ?</p>

<p>a number of approaches were tried, none of which worked 100%, they part worked or ended up with the application being deployed twice. Pain, pain, pain.</p>

<p>Trying to use docbase in the server.xml, i.e.</p>

<p><code>&lt;Context path="" docBase="foo" debug="1"/&gt;</code></p>

<p>will result in the application being deployed to / and /foo - not good, we only want it deployed once.</p>

<p>So, take a step back. Only one application can be deployed under / and for tomcat, this defaults to one called ROOT.war, so rather than creating and deploying foo.war, call it ROOT.war and it will deploy to /, once and everyone is happy.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/30/what-is-an-expert/">What Is an Expert and Top Ten Reasons Managers Become Great - Links</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-30T12:24:35+01:00" pubdate data-updated="true">Apr 30<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>You&#8217;re not going to find the answer here (arf), but I love this <a href="http://softwarecreation.org/2009/how-to-become-an-expert-top-7-qualities/">article</a> on what it takes to become an expert. This point I find particularly interesting:</p>

<blockquote>tacit knowledge: automatic, unexpressed knowledge that provides context for people, places, ideas, and experiences. Tacit knowledge is not easily shared. As Polanyi said: “We know more than we can tell.”</blockquote>


<p>I like <a href="http://www.scottberkun.com/blog/2009/top-ten-reasons-managers-become-great/">this</a> too, especially the point that managers become great if they are self aware - they know their weaknesses and they make sure someone is covering their back.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/22/hibernate-search-lucene-and-greenwich-mean-time/">Hibernate Search, Lucene and Greenwich Mean Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-22T11:20:05+01:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Aww, what a gotcha this morning. Felt stoopid when I realised what was going on.</p>

<p>There are a number of ways to use dates with Lucene and specifically with Hibernate Search, which is what I&#8217;m using at the moment for providing a wrapper around Lucene. I wanted to search for a certain date range on a field.. which has been set to midnight. You can probably guess what&#8217;s coming here. Now we&#8217;re in British Summer Time our clocks are forward, but of course, the date is stored by Lucene as GMT, consequently, without a bit of cleverness, something saved at 12:01 AM on the 2nd April BST, is actually 11:01 PM on the 1st April GMT.</p>

<p>Throw in a date range search looking for stuff from the 2nd April onwards and things start going a bit wonky!</p>

<p>By the way, here is how it now woorks, still may not be the best way to do it, but it&#8217;s working for now.</p>

<p><code> @Field(index = Index.UN_TOKENIZED)
@DateBridge(resolution = Resolution.HOUR)
@Temporal(TemporalType.DATE)
private Date startDate;</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/14/gotcha-with-auto-ddl-generation-and-hibernate/">Gotcha With Auto DDL Generation and Hibernate</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-14T12:41:31+01:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>During project development, we&#8217;re auto creating our database when the application initiates. This is superuseful initially, especially when the database is based on the domain objects rather than the other way around. Since switching to MySQL and a &#8216;real&#8217; database, rather than one in memory, there are a few gotchas. The one which caught me out this morning, for a few hours, involved adding and removing foreign keys automagically&#8230; it doesn&#8217;t really work!</p>

<p>this is useful by the way for <a href="http://www.hibernate.org/hib_docs/reference/en/html/configuration-optional.html">hibernate config</a> as is <a href="http://www.jroller.com/eyallupu/entry/hibernate_s_hbm2ddl_tool">this</a></p>

<p>anyway, we were set - <code>hibernate.hbm2ddl.auto=create</code></p>

<p>when actually, we should have used create-drop.</p>

<p>create will empty the database, whereas create-drop will properly drop it&#8230;</p>

<p>for completeness, here is the configuration for a entity manager, with the generate DDL parameter switching the ddl generation on and off, and the hibernate.hbm2ddl.auto parameter determining whether you do a create each time or an update or whatever.</p>

<pre>&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
        &lt;property name="loadTimeWeaver"&gt;
            &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver" /&gt;
        &lt;/property&gt;
        &lt;property name="persistenceUnitName" value="projectNamePU" /&gt;
        &lt;property name="jpaPropertyMap"&gt;
            &lt;map&gt;
                &lt;entry key="hibernate.search.default.directory_provider" value="org.hibernate.search.store.RAMDirectoryProvider"  /&gt;   
                &lt;entry key="hibernate.cache.provider_class" value="net.sf.ehcache.hibernate.SingletonEhCacheProvider" /&gt;
                &lt;entry key="hibernate.cache.provider_configuration" value="classpath:ehCache.xml" /&gt;
                &lt;entry key="hibernate.cache.use_second_level_cache" value="true" /&gt;
                &lt;entry key="hibernate.generate_statistics" value="true" /&gt;
                &lt;entry key="hibernate.cache.use_structured_entries" value="true" /&gt;
                &lt;entry key="hibernate.jdbc.batch_size" value="0" /&gt;
            &lt;entry key="hibernate.default_batch_fetch_size" value="20"/&gt;
            <span style="color: #ff0000">&lt;entry key="hibernate.hbm2ddl.auto" value="${hibernate.hbm2ddl.auto}" /&gt;</span>
            &lt;/map&gt;
        &lt;/property&gt;

        &lt;property name="dataSource" ref="dataSource"/&gt;
        &lt;property name="jpaVendorAdapter"&gt;
           &lt;bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"&gt;
                &lt;property name="database" value="${hibernate.database}" /&gt;
                &lt;property name="showSql" value="${hibernate.show_sql}" /&gt;
                <span style="color: #ff0000">&lt;property name="generateDdl" value="${hibernate.generate_ddl}" /&gt;</span>
                &lt;property name="databasePlatform" value="${hibernate.dialect}" /&gt;
            &lt;/bean&gt;          
        &lt;/property&gt;
    &lt;/bean&gt;</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/14/java-dates-and-times/">Java Dates and Times&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-14T10:38:17+01:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>.. have always been a bit of a crock. Lumpy and confusing. Apache common date utils have helped, but still you end up witing unintuitive code.</p>

<p>Many in the java community were hoping that JSR 310 was going to save the day, but it is looking more and more likely that it will not now make the cut for JDK 7. So, where does that leave us?</p>

<p>Hello <a href="http://joda-time.sourceforge.net/">Joda-Time</a>!</p>

<p>So, the drive behind JSR 310 was really incorporating Joda-Time in to the java specification. I&#8217;ve only just discovered Joda-Time and haven&#8217;t used it in anger, but I really wish I&#8217;d found it sooner and will be looking to take it out for a spin at the earliest opportunity.</p>

<p>this, from the overview page gives you a tast of what Joda-Time gives you&#8230;</p>

<pre>public boolean isAfterPayDay(DateTime datetime) {</pre>


<pre>  if (datetime.getMonthOfYear() == 2) {   // February is month 2!!</pre>


<pre>    return datetime.getDayOfMonth() &gt; 26;</pre>


<pre>  }</pre>


<pre>  return datetime.getDayOfMonth() &gt; 28;</pre>


<pre>}</pre>


<pre>public Days daysToNewYear(LocalDate fromDate) {</pre>


<pre>  LocalDate newYear = fromDate.plusYears(1).withDayOfYear(1);</pre>


<pre>  return Days.daysBetween(fromDate, newYear);</pre>


<pre>}</pre>


<pre></pre>


<pre>public boolean isRentalOverdue(DateTime datetimeRented) {</pre>


<pre>  Period rentalPeriod = new Period().withDays(2).withHours(12);</pre>


<pre>  return datetimeRented.plus(rentalPeriod).isBeforeNow();</pre>


<pre>}</pre>


<pre></pre>


<pre>public String getBirthMonthText(LocalDate dateOfBirth) {</pre>


<pre>  return dateOfBirth.monthOfYear().getAsText(Locale.ENGLISH);</pre>


<pre>}</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/09/migrating-packages-from-old-machine-to-new/">Migrating Packages From Old Machine to New</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-09T12:41:31+01:00" pubdate data-updated="true">Apr 9<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Before switching off your old ubuntu machine for good, run</p>

<pre>dpkg --get-selections &gt; Packages.lst</pre>


<p>which will output all the stuff you&#8217;ve installed using the package manager to a flat file (Packages.lst). Copy this file to your new machine.</p>

<pre>dpkg --set-selections &lt; Packages.lst</pre>


<p>will then set all those packages ready for install on your new machine.</p>

<p>Martin reckons run this first as a dry-run</p>

<pre>sudo apt-get -s dselect-upgrade</pre>


<p>and then when you are feeling brave</p>

<pre>sudo apt-get dselect-upgrade</pre>


<p>will install them for you&#8230;hopefully!</p>

<p>oh and watch out for things you <em>don&#8217;t</em> want to install on the new machine, like gfx drivers. You can remove them from Packages.lst</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/07/fed-up-with-your-iphone-opening-iphoto/">Fed Up With Your iPhone Opening iPhoto?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-07T21:21:02+01:00" pubdate data-updated="true">Apr 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Then nip it in the bud by opening Image Capture and setting it not to open anything in the preferences (not in the app, but from the menu).. hurrah!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/07/uml-diagrams-in-javadocs/">UML Diagrams in Javadocs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-07T12:48:37+01:00" pubdate data-updated="true">Apr 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ok, so after all that excitement about javadocs, now we can really push the boat out by getting a maven plugin to also auto create UML diagrams. &#8220;Diagrams&#8221; I hear you ask, yes diagrams. Useful for people like me who like pictures.</p>

<p>So, this requires two steps. The first is to install graphviz which the plug in uses to create the pictures. A simple process on a linux box with apt-get.</p>

<p>The second is adding the following configuration to the pom&#8230;</p>

<pre>   &lt;plugin&gt;
        &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.6&lt;/source&gt;
          &lt;aggregate&gt;true&lt;/aggregate&gt;
          &lt;doclet&gt;gr.spinellis.umlgraph.doclet.UmlGraphDoc&lt;/doclet&gt;
          &lt;docletArtifact&gt;
            &lt;groupId&gt;gr.spinellis&lt;/groupId&gt;
            &lt;artifactId&gt;UmlGraph&lt;/artifactId&gt;
            &lt;version&gt;4.6&lt;/version&gt;
          &lt;/docletArtifact&gt;
          &lt;additionalparam&gt;
            -inferrel -inferdep -quiet -hide java.*
            -collpackages java.util.* -qualify
            -postfixpackage -nodefontsize 9
            -nodefontpackagesize 7
          &lt;/additionalparam&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</pre>


<p>now, when you build the maven site you get nice UML diagrams in your javadocs</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/07/asking-maven-to-produce-your-javadocs/">Asking Maven to Produce Your Javadocs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-07T10:33:11+01:00" pubdate data-updated="true">Apr 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Javadocs are the java platforms standard way of producing code documentation, comments about what the class is for, which methods are provided and all that kind of stuff. It feels a bit old school now, but they are really useful if kept up to date.</p>

<p>As we are building our project using maven, we can ask maven to build a &#8216;site&#8217; for our project. This pulls in various bits of information about the project, including dependencies on other libraries (and their licencing models) and all kinds of interesting stuff.</p>

<p>One of the maven plugins generates the javadocs for your project and it&#8217;s very straightforward to set up, just add this to the reporting section of your pom file (for maven) and when you do a mvn site it automatically builds your javadocs.</p>

<pre>&lt;plugin&gt;
&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
&lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
&lt;/plugin&gt;</pre>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/18/downloading-the-network-rail-schedules/">Downloading the Network Rail Schedules</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/16/the-electrified-spine-and-the-rest-of-the-news/">The Electrified Spine (and the rest of the news)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/04/getting-started-with-network-rails-datafeeds/">Getting started with Network Rail&#8217;s datafeeds</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/22/week-10-the-end-of-the-happenstance/">Week 10 - the end of the Happenstance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/15/whatever-next-the-technical-stuff/">Whatever next - the technical stuff</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
